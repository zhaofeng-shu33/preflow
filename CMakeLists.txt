cmake_minimum_required(VERSION 3.5)
project(preflow LANGUAGES CXX)
set (CMAKE_CXX_STANDARD 11)
option(ENABLE_TESTING "Enable testing" OFF)
option(USE_BOOST_OPTION ON)
find_package(lemon REQUIRED)


find_package(Boost REQUIRED program_options)
add_executable(lgf_compute main.cpp)
target_include_directories(lgf_compute PUBLIC ${Boost_INCLUDE_DIRS})
target_link_libraries(lgf_compute ${LEMON_LIBRARY})
if(WIN32)
    target_link_libraries(lgf_compute debug ${Boost_PROGRAM_OPTIONS_LIBRARY_DEBUG})    
    target_link_libraries(lgf_compute optimized ${Boost_PROGRAM_OPTIONS_LIBRARY_RELEASE})
else()    
    target_link_libraries(lgf_compute ${Boost_PROGRAM_OPTIONS_LIBRARY_RELEASE})
endif()

if(ENABLE_TESTING)
    if(USE_BOOST_OPTION)
        add_executable(speed_test speed_test.cpp)
        target_include_directories(speed_test PUBLIC ${Boost_INCLUDE_DIRS})
        target_link_libraries(speed_test ${LEMON_LIBRARY})

        if(WIN32)
            target_link_libraries(speed_test debug ${Boost_PROGRAM_OPTIONS_LIBRARY_DEBUG})    
            target_link_libraries(speed_test optimized ${Boost_PROGRAM_OPTIONS_LIBRARY_RELEASE})
        else()    
            target_link_libraries(speed_test ${Boost_PROGRAM_OPTIONS_LIBRARY_RELEASE})
        endif()
    endif()
    add_executable(test_mf test.cpp)
    target_link_libraries(test_mf ${LEMON_LIBRARY})
    find_package(GTest REQUIRED)
    include_directories(${GTEST_INCLUDE_DIR})
    if(WIN32)
        target_link_libraries(test_mf debug ${GTEST_MAIN_LIBRARY_DEBUG} debug ${GTEST_LIBRARY_DEBUG})
        target_link_libraries(test_mf optimized ${GTEST_MAIN_LIBRARY} optimized ${GTEST_LIBRARY})
    elseif(UNIX)
        target_link_libraries(test_mf ${GTEST_MAIN_LIBRARY} ${GTEST_LIBRARY} pthread)
    endif()  
    # copy the graph data file to build directory
    configure_file(${PROJECT_SOURCE_DIR}/test.lgf ${PROJECT_BINARY_DIR}/test.lgf COPYONLY)
endif()
